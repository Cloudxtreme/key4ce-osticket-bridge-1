<?phprequire_once( WP_PLUGIN_DIR . '/key4ce-osticket-bridge/admin/db-settings.php' );require_once( WP_PLUGIN_DIR . '/key4ce-osticket-bridge/includes/functions.php' ); $time_format=key4ce_getKeyValue('time_format');$date_format=key4ce_getKeyValue('date_format');$datetime_format=key4ce_getKeyValue('datetime_format');if(isset($_POST['delete'])){		$delete_ticket_list=$_POST['tickets'];		$i=0;	foreach($delete_ticket_list as $delete_ticket){					$ost_wpdb->query("DELETE FROM $ticket_table WHERE ticket_id =".$delete_ticket);		$ost_wpdb->query("DELETE FROM $thread_table WHERE ticket_id =".$delete_ticket);			$ost_wpdb->query("DELETE FROM $ticket_cdata WHERE ticket_id =".$delete_ticket);		$file_id = $ost_wpdb->get_var("SELECT file_id from $ost_ticket_attachment WHERE ticket_id = '$delete_ticket'");			$ost_wpdb->query("DELETE FROM $ost_file WHERE id =".$file_id);		$ost_wpdb->query("DELETE FROM $ost_ticket_attachment WHERE ticket_id =".$delete_ticket);						$i++;	}	$deletedstr = sprintf( __( '%d record(s) has been deleted successfully', 'key4ce-osticket-bridge' ),$i);	echo '<div style="color: red;font-size: 15px;font-weight: bold;margin-top: 20px;text-align: center;">'.$deletedstr.'</div>';	echo "<script>window.location.href=location.href;</script>";	}if(isset($_POST['close'])){			$close_ticket_list=$_POST['tickets'];	$i=0;	foreach($close_ticket_list as $close_ticket){					if($keyost_version==194 || $keyost_version==195 || $keyost_version==1951)			$ost_wpdb->update($ticket_table, array('status_id'=>'3'), array('ticket_id'=>$close_ticket), array('%s'));		else			$ost_wpdb->update($ticket_table, array('status'=>'closed'), array('ticket_id'=>$close_ticket), array('%s'));		$i++;	}	$closedstr = sprintf( __( '%d record(s) has been closed successfully', 'key4ce-osticket-bridge' ),$i);	echo "<div style=' color: red;font-size: 15px;font-weight: bold;margin-top: 20px;text-align: center;'>".$closedstr."</div>";	echo "<script>window.location.href=location.href;</script>";	}if(isset($_POST['reopen'])){				$reopen_ticket_list=$_POST['tickets'];	$i=0;	foreach($reopen_ticket_list as $reopen_ticket){						if($keyost_version==194 || $keyost_version==195 || $keyost_version==1951)			$ost_wpdb->update($ticket_table, array('status_id'=>'1'), array('ticket_id'=>$reopen_ticket), array('%s'));		else			$ost_wpdb->update($ticket_table, array('status'=>'open'), array('ticket_id'=>$reopen_ticket), array('%s'));		$i++;	}	$reopenedstr = sprintf( __( '%d record(s) has been re-opened successfully', 'key4ce-osticket-bridge' ),$i);	echo "<div style=' color: red;font-size: 15px;font-weight: bold;margin-top: 20px;text-align: center;'>".$reopenedstr."</div>";	echo "<script>window.location.href=location.href;</script>";	}	?><script type="text/javascript">function checkAll(ele) {     var checkboxes = document.getElementsByTagName('input');     if (ele.checked) {         for (var i = 0; i < checkboxes.length; i++) {             if (checkboxes[i].type == 'checkbox') {                 checkboxes[i].checked = true;             }         }     } else {         for (var i = 0; i < checkboxes.length; i++) {             console.log(i)             if (checkboxes[i].type == 'checkbox') {                 checkboxes[i].checked = false;             }         }     } } function editThis(id){	location.href='admin.php?page=ost-tickets&service=view&ticket='+id; } jQuery(document).ready(function() {  jQuery('#ui-id-7 td.noEdit').click(function(e){   e.stopPropagation();});});</script><style>.key4ce_table {margin-bottom: 20px;max-width: 100%;width: 100%;}table {background-color: transparent;border-collapse: collapse;border-spacing: 0;}.key4ce_table > tbody > tr > td, .key4ce_table > tbody > tr > th, .key4ce_table > tfoot > tr > td, .key4ce_table > tfoot > tr > th, .key4ce_table > thead > tr > td, .key4ce_table > thead > tr > th {    border-bottom: 1px solid #ddd;    line-height: 1.42857;    padding: 2px;}th {text-align: left;color: #666;font-family: arial;font-weight: bold;padding: 2px !important;background-color: #dfdfdf;line-height: 1.42857;}td, th {padding: 0;}*::after, *::before {box-sizing: border-box;}.key4ce_table > caption + thead > tr:first-child > td, .key4ce_table > caption + thead > tr:first-child > th, .key4ce_table > colgroup + thead > tr:first-child > td, .key4ce_table > colgroup + thead > tr:first-child > th, .key4ce_table > thead:first-child > tr:first-child > td, .key4ce_table > thead:first-child > tr:first-child > th {border-top: 0 none;}.key4ce_table > thead > tr > th {border-bottom: 2px solid #ddd;height: 35px;}.key4ce_table > tbody > tr:hover {background-color: #f9f8f8;cursor: pointer;}.key4ce_ticketPriority {border: 1px solid white;border-radius: 10px;color: white;font-weight: bold;padding: 5px;}	</style><form name="ticketview" id="ticketview" method="post" onSubmit="if(!confirm('<?php echo __("Are you sure you want to continue?", 'key4ce-osticket-bridge'); ?>')){return false;}"><div class="key4ce_wrap"><div class="key4ce_headtitle"><?php echo __("Support/Request List", 'key4ce-osticket-bridge'); ?></div><div style="clear: both"></div><?php require_once( WP_PLUGIN_DIR . '/key4ce-osticket-bridge/admin/header_nav_ticket.php' ); ?>	<div style="clear: both"></div>        <div align="center" style="padding-top:20px;"></div>        <table class="key4ce_table"><?phpif($list_opt){function ezDate($d) {        $ts = time() - strtotime(str_replace("-","/",$d));        if($ts>31536000) $val = round($ts/31536000,0).' year';        else if($ts>2419200) $val = round($ts/2419200,0).' month';        else if($ts>604800) $val = round($ts/604800,0).' week';        else if($ts>86400) $val = round($ts/86400,0).' day';        else if($ts>3600) $val = round($ts/3600,0).' hour';        else if($ts>60) $val = round($ts/60,0).' minute';        else $val = $ts.' second';        if($val>1) $val .= 's';         return $val; 	}?><thead>      <tr>        <th><input type="checkbox"  onchange="checkAll(this)" name="chk[]"></th>        <th><?php echo __("Ticket #", 'key4ce-osticket-bridge'); ?></th>        <th><?php echo __("Subject", 'key4ce-osticket-bridge'); ?></th>	<th><?php echo __("Priority", 'key4ce-osticket-bridge'); ?></th>        <th><?php echo __("Department", 'key4ce-osticket-bridge'); ?></th>        <th><?php echo __("Help Topic", 'key4ce-osticket-bridge'); ?></th>        <th><?php echo __("Date", 'key4ce-osticket-bridge'); ?></th>      </tr></thead><tbody>    <?php    foreach($list_opt as $list){        if($list->updated=="0000-00-00 00:00:00"){            $list_updated="-";            }else{                $list_updated=ucwords(ezDate($list->updated)).' Ago';                }                if ($list->subject==""){                    @$sub_str=Format::stripslashes('Ticket subject not found');                    } else {                        @$sub_str=Format::stripslashes($list->subject);                    }                    if($keyost_version==194 || $keyost_version==195 || $keyost_version==1951)                        $priority=$list->priority;                    else                        $priority=$list->priority_id;                    if($priority==4)                        $color="red";                    elseif($priority==3)                        $color="orange";                    elseif($priority==2 || $priority=="")                        $color="green";                    elseif($priority==1)                        $color="black";                    ?>      <tr id="ui-id-7" onclick="editThis(<?php echo $list->number; ?>);">        <td class="noEdit"><input type='checkbox' name='tickets[]' value=<?php echo $list->ticket_id; ?>></td>        <td><?php echo $list->number; ?></td>        <td><?php echo key4ce_truncate($sub_str,60,'...'); ?></td>		<td>		<?php if($priority==4){ ?>		<div class="key4ce_ticketPriority" style="background-color:red;"><?php echo __("Emergency", 'key4ce-osticket-bridge'); ?></div>		<?php } elseif($priority==3){ ?>		<div class="key4ce_ticketPriority" style="background-color:orange;"><?php echo __("High", 'key4ce-osticket-bridge'); ?></div>		<?php } elseif($priority==2 || $priority==""){ ?>		<div class="key4ce_ticketPriority" style="background-color:green;"><?php echo __("Normal", 'key4ce-osticket-bridge'); ?></div>		<?php } elseif($priority==1){ ?>                <div class="key4ce_ticketPriority" style="background-color:black;"><?php echo __("Low", 'key4ce-osticket-bridge'); ?></div>		<?php } ?>		</td>		<td><?php echo $list->dept_name; ?></td>		<td><?php echo $list->topic; ?></td>		<td>		<?php 		if ($list->updated=='0000-00-00 00:00:00'){			$date_str  = "".$list->created."";		}else{			$date_str  = "".$list->updated.""; 		}		echo date($datetime_format,strtotime($date_str));		?>		</td>		</span>      </tr>	  <?php	} ?>    </tbody><?php } else { echo "No Records Found"; } ?></table><div align="center" style="padding-top:15px;"></div><div style="clear: both"></div><?php if(count($list_opt) > 0) { ?><div><input type="submit" name="delete" value="<?php echo __("Delete", 'key4ce-osticket-bridge'); ?>"><?php if(@$_REQUEST['status']=="open" || @$_REQUEST['status']=="answered") { ?><input type="submit" name="close" value="<?php echo __("Close", 'key4ce-osticket-bridge'); ?>"><?php } else if (@$_REQUEST['status']=="all") {?><input type="submit" name="close" value="<?php echo __("Close", 'key4ce-osticket-bridge'); ?>"><input type="submit" name="reopen" value="<?php echo __("Reopen", 'key4ce-osticket-bridge'); ?>"><?php } else if (@$_REQUEST['status']=="closed") { ?><input type="submit" name="reopen" value="<?php echo __("Reopen", 'key4ce-osticket-bridge'); ?>"><?php  } else {?><input type="submit" name="close" value="<?php echo __("Close", 'key4ce-osticket-bridge'); ?>"><?php } ?></div><?php } ?><?php require_once( WP_PLUGIN_DIR . '/key4ce-osticket-bridge/includes/pagination.php' ); ?></div><!--End wrap--></form>